<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zero.plantoryprojectbe.profile.ProfileSharingInsertMapper">
    <select id="selectInterestSharingList" resultType="com.zero.plantoryprojectbe.profile.dto.ProfileSharingResponse">
        SELECT
        s.sharing_id,
        s.title,
        s.status,
        s.interest_num,
        s.created_at,
        COALESCE(c.comment_count, 0) AS comment_count,
        COUNT(*) OVER() AS total_count
        FROM interest it
        JOIN sharing s ON it.sharing_id = s.sharing_id
        LEFT JOIN (
        SELECT sharing_id, COUNT(*) AS comment_count
        FROM comment
        WHERE del_flag IS NULL
        GROUP BY sharing_id
        ) c ON c.sharing_id = s.sharing_id
        WHERE it.member_id = #{memberId}
        AND s.del_flag IS NULL
        <if test="keyword != null and keyword != ''">
            AND s.title LIKE CONCAT('%', #{keyword}, '%')
        </if>
        ORDER BY s.created_at DESC
        LIMIT #{limit}
        OFFSET #{offset}
    </select>
</mapper>
